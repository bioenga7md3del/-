<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>

<div class="container">
    
    <div class="admin-panel">
        <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-weight: 800;">๐ ุจูุงุจุฉ ุงูุฅุฏุงุฑุฉ</span>
            <span id="roleDisplay" style="color: #f1c40f; font-size: 12px;"></span>
        </div>
        
        <div id="loginSection">
            <button class="btn-blue" onclick="adminLogin()">๐ ุฏุฎูู</button>
        </div>

        <div id="adminControls" class="admin-btns">
            <button class="btn-purple super-admin-only" onclick="openModal('contractorModal')">๐ท ุงูููุงูููู</button>
            <button class="btn-green super-admin-only" onclick="openModal('contractModal')">โ ุนูุฏ ุฌุฏูุฏ</button>
            <button class="btn-blue super-admin-only" onclick="refreshMonthsSystem()">๐ ุชุญุฏูุซ ุงูุดููุฑ</button>
            <button class="btn-orange super-admin-only" onclick="systemReset()">โ ุชููุฆุฉ</button>
            <button class="btn-red" onclick="location.reload()">ุฎุฑูุฌ</button>
        </div>
        
        <div style="display: flex; gap: 5px;">
            <button class="btn-green" onclick="exportToExcel()">๐ Excel</button>
            <button class="btn-blue" onclick="window.print()">๐จ ุทุจุงุนุฉ</button>
        </div>
    </div>

    <header>
        <div class="header-text">
            <h1>ูุธุงู ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ</h1>
            <h2>ูุคุดุฑ ุงูุฃุฏุงุก ูุฑูุน ุงููุณุชุฎูุตุงุช ุงูุดูุฑูุฉ</h2>
        </div>
        <div class="logo-container"><img src="TabukCluster.jpeg" alt="Logo"></div>
    </header>

    <div class="dashboard-container">
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-number" id="countHospitals">0</span>
                <span class="stat-label">ุงูููุงูุน</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="countContracts">0</span>
                <span class="stat-label">ุงูุนููุฏ ุงููุดุทุฉ</span>
            </div>
            <div class="stat-card red-border">
                <span class="stat-number" id="countLate" style="color: var(--danger);">0</span>
                <span class="stat-label">ุฅุฌูุงูู ุงููุชุฃุฎุฑุงุช</span>
            </div>
            <div class="stat-card green-border">
                <span class="stat-number" id="complianceRate">0%</span>
                <span class="stat-label">ูุณุจุฉ ุงูุฅูุฌุงุฒ</span>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="kpiChart"></canvas>
        </div>
    </div>

    <div class="toolbar-section">
        <div class="filter-group">
            <span class="filter-label">๐ข ุงููููุน:</span>
            <select id="filterHospital" class="form-control" onchange="renderTable()">
                <option value="all">ูู ุงูููุงูุน</option>
            </select>
        </div>
        
        <div class="filter-group">
            <span class="filter-label">๐ท ุงูููุงูู:</span>
            <select id="filterContractor" class="form-control" onchange="renderTable()">
                <option value="all">ูู ุงูููุงูููู</option>
            </select>
        </div>

        <div class="filter-group">
            <span class="filter-label">๐ ุงูููุน:</span>
            <select id="filterType" class="form-control" onchange="renderTable()">
                <option value="all">ุงููู</option>
                <option value="ุทุจู">ุทุจู</option>
                <option value="ุบูุฑ ุทุจู">ุบูุฑ ุทุจู</option>
            </select>
        </div>
    </div>

    <div id="loader" style="text-align: center; color: var(--primary); padding: 20px;">ุฌุงุฑู ุชุญููู ุงููุธุงู...</div>
    <div id="toast">ุชู ุงูุญูุธ</div>

    <div class="table-wrapper">
        <table id="mainTable" style="display:none;">
            <thead><tr id="headerRow"></tr></thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <footer style="text-align: center; margin-top: 20px; font-size: 11px; color: #777;">
        ูุธุงู ุฅุฏุงุฑุฉ ุนููุฏ ุงูุตูุงูุฉ - ุชุฌูุน ุชุจูู ุงูุตุญู
    </footer>
</div>

<div id="contractModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ุฅุถุงูุฉ ุนูุฏ ุฌุฏูุฏ</h3>
            <button class="close-btn" onclick="closeModal('contractModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>ุงููููุน / ุงููุณุชุดูู <span style="color:red">*</span></label>
                <input type="text" id="form-hospital" class="form-control" placeholder="ุงุณู ุงููููุน...">
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex:1">
                    <label>ุงูููุน <span style="color:red">*</span></label>
                    <select id="form-type" class="form-control">
                        <option value="ุทุจู">ุทุจู</option>
                        <option value="ุบูุฑ ุทุจู">ุบูุฑ ุทุจู</option>
                    </select>
                </div>
                <div class="form-group" style="flex:1">
                    <label>ุงูููุงูู <span style="color:red">*</span></label>
                    <select id="form-contractor" class="form-control"><option value="">...</option></select>
                </div>
            </div>
            <div style="display: flex; gap: 10px;">
                <div class="form-group" style="flex:1"><label>ุชุงุฑูุฎ ุงูุจุฏุงูุฉ</label><input type="date" id="form-start-date" class="form-control"></div>
                <div class="form-group" style="flex:1"><label>ุชุงุฑูุฎ ุงูููุงูุฉ</label><input type="date" id="form-end-date" class="form-control"></div>
            </div>
            <div class="form-group"><label>ูููุฉ ุงูุนูุฏ</label><input type="number" id="form-value" class="form-control"></div>
            <div class="form-group"><label>ุฑูู ุงูุนูุฏ</label><input type="text" id="form-contract-num" class="form-control"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-blue" onclick="saveNewContract()">ุญูุธ</button>
            <button class="btn-red" onclick="closeModal('contractModal')">ุฅูุบุงุก</button>
        </div>
    </div>
</div>

<div id="contractorModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h3>ุงูููุงูููู</h3><button class="close-btn" onclick="closeModal('contractorModal')">&times;</button></div>
        <div class="modal-body">
            <div class="form-group" style="display:flex; gap:10px;">
                <input type="text" id="form-new-contractor" class="form-control" placeholder="ุงุณู ุงูุดุฑูุฉ...">
                <button class="btn-purple" onclick="saveNewContractor()">ุฅุถุงูุฉ</button>
            </div>
            <hr>
            <div id="contractorsList" style="max-height:200px; overflow-y:auto; font-size:12px;"></div>
        </div>
    </div>
</div>

<script type="module" src="js/app.js"></script>
</body>
</html>
